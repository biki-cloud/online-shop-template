### **オンラインショップ MVP 要件定義**

#### **1. システム概要**

特定のカテゴリーの商品を販売するオンラインショップ。  
商品情報は Web サイトで管理し、決済は Stripe を利用する。  
Supabase を S3 および PostgreSQL のホスティングに使用する。

---

## **2. 機能要件**

### **🔹 2.1 フロントエンド（ユーザー向け）**

#### ✅ **商品一覧ページ**

- 商品の画像、名前、説明、価格を表示
- カートに追加ボタン
- 商品の詳細ページへ遷移

#### ✅ **商品詳細ページ**

- 画像、商品名、説明、価格を表示
- **「購入する」ボタン → Stripe Checkout に遷移**

#### ✅ **カート機能**

- ユーザーが商品をカートに追加・削除できる
- カート内の商品一覧を表示
- **「決済へ進む」ボタン → Stripe Checkout に遷移**

#### ✅ **ユーザー認証（NextAuth）**

- **ログイン / ログアウト**
- **ユーザー登録（OAuth, Email & Password）**
- **ユーザー情報編集（名前・メールアドレス変更）**

---

### **🔹 2.2 管理画面（管理者向け）**

#### ✅ **商品管理**

- **商品登録**
  - 商品名、説明、画像をアップロード（Supabase S3）
  - 価格を入力し、Stripe に登録
  - Stripe の`Product ID`を DB に保存
- **商品編集**（名前・説明・画像の更新）
- **商品削除**（Web サイト DB のデータを削除、Stripe の価格データは残す）

#### ✅ **ユーザー管理**（最低限の機能）

- ユーザーの一覧表示
- ユーザー情報の編集（管理者権限の付与など）

---

## **3. 非機能要件**

### **🔹 3.1 技術スタック**

- **Next.js**（フロントエンド & API Routes）
- **Drizzle ORM + Supabase（PostgreSQL）**（データ管理）
- **Stripe**（決済 & 価格管理）
- **NextAuth.js**（認証）
- **Tailwind CSS + ShadCN**（UI デザイン）

### **🔹 3.2 ホスティング & インフラ**

- **Vercel**（Next.js のホスティング）
- **Supabase（PostgreSQL & S3）**（DB & 画像ストレージ）

### **🔹 3.3 運用・管理**

- **商品登録・編集は管理者のみ可能**（管理画面を用意）
- **一般ユーザーは閲覧 & 購入のみ可能**
- **決済は Stripe の Checkout を利用し、Web サイト側でカード情報を持たない**

---

## **4. ユーザーフロー**

### **🔹 4.1 一般ユーザーの流れ**

1. Web サイトを訪問し、商品一覧を閲覧
2. 商品詳細ページで「購入する」ボタンをクリック
3. **Stripe Checkout に遷移し、決済**
4. **決済完了後、注文履歴ページにリダイレクト**
5. ユーザーは注文履歴から購入履歴を確認できる

### **🔹 4.2 管理者の流れ**

1. ログインして管理画面にアクセス
2. 商品の追加・編集・削除を実行
3. ユーザー情報を管理（必要に応じて）

---

## **5. MVP スコープ**

| 機能                            | 必須 | 将来的に追加 |
| ------------------------------- | ---- | ------------ |
| 商品一覧・詳細ページ            | ✅   |              |
| Stripe 決済（Checkout）         | ✅   |              |
| カート機能                      | ✅   |              |
| ログイン（NextAuth）            | ✅   |              |
| ユーザー情報編集                | ✅   |              |
| 商品管理（登録・編集・削除）    | ✅   |              |
| 画像アップロード（Supabase S3） | ✅   |              |
| 注文履歴                        | ✅   |              |
| レビュー機能                    | ❌   | ✅           |
| クーポン機能                    | ❌   | ✅           |
| ダッシュボード（売上分析）      | ❌   | ✅           |

---

## **6. 今後の課題**

- **決済フローの改善**（Stripe Webhook を使って支払いステータスを DB に保存する）
- **UI/UX の向上**（ShadCN を活用し、管理画面を使いやすくする）
- **発送管理の仕組みをどうするか？**（別途、管理者が手動 or 外部サービス連携）

---
